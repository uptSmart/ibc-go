"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8436],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=a.createContext({}),s=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=s(e.components);return a.createElement(c.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,l=e.originalType,c=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),p=s(n),h=i,m=p["".concat(c,".").concat(h)]||p[h]||d[h]||l;return n?a.createElement(m,o(o({ref:t},u),{},{components:n})):a.createElement(m,o({ref:t},u))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var l=n.length,o=new Array(l);o[0]=h;var r={};for(var c in t)hasOwnProperty.call(t,c)&&(r[c]=t[c]);r.originalType=e,r[p]="string"==typeof e?e:i,o[1]=r;for(var s=2;s<l;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},87390:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>l,metadata:()=>r,toc:()=>s});var a=n(87462),i=(n(67294),n(3905));const l={},o="ADR 009: ICS27 message server addition",r={unversionedId:"adr-009-v6-ics27-msgserver",id:"adr-009-v6-ics27-msgserver",title:"ADR 009: ICS27 message server addition",description:"Changelog",source:"@site/architecture/adr-009-v6-ics27-msgserver.md",sourceDirName:".",slug:"/adr-009-v6-ics27-msgserver",permalink:"/architecture/adr-009-v6-ics27-msgserver",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"defaultSidebar",previous:{title:"ADR 008: Callback to IBC Actors",permalink:"/architecture/adr-008-app-caller-cbs"},next:{title:"ADR 010: IBC light clients as SDK modules",permalink:"/architecture/adr-010-light-clients-as-sdk-modules"}},c={},s=[{value:"Changelog",id:"changelog",level:2},{value:"Status",id:"status",level:2},{value:"Context",id:"context",level:2},{value:"Decision",id:"decision",level:2},{value:"Msg server",id:"msg-server",level:3},{value:"Allow <code>nil</code> underlying applications",id:"allow-nil-underlying-applications",level:3},{value:"Channel capability claiming",id:"channel-capability-claiming",level:3},{value:"Middleware enabled channels",id:"middleware-enabled-channels",level:3},{value:"Future considerations",id:"future-considerations",level:3},{value:"Miscellaneous",id:"miscellaneous",level:3},{value:"Consequences",id:"consequences",level:2},{value:"Positive",id:"positive",level:3},{value:"Negative",id:"negative",level:3},{value:"Neutral",id:"neutral",level:3}],u={toc:s},p="wrapper";function d(e){let{components:t,...n}=e;return(0,i.kt)(p,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"adr-009-ics27-message-server-addition"},"ADR 009: ICS27 message server addition"),(0,i.kt)("h2",{id:"changelog"},"Changelog"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"2022/09/07: Initial draft")),(0,i.kt)("h2",{id:"status"},"Status"),(0,i.kt)("p",null,"Accepted, implemented in v6 of ibc-go"),(0,i.kt)("h2",{id:"context"},"Context"),(0,i.kt)("p",null,"ICS 27 (Interchain Accounts) brought a cross-chain account management protocol built upon IBC.\nIt enabled chains to programatically create accounts on behalf of counterparty chains which may enable a variety of authentication methods for this interchain account.\nThe initial release of ICS 27 focused on enabling authentication schemes which may not require signing with a private key, such as via on-chain mechanisms like governance."),(0,i.kt)("p",null,"Following the initial release of ICS 27 it became evident that:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"a default authentication module would enable more usage of ICS 27"),(0,i.kt)("li",{parentName:"ul"},"generic authentication modules should be capable of authenticating an interchain account registration"),(0,i.kt)("li",{parentName:"ul"},"application logic which wraps ICS 27 packet sends do not need to be associated with the authentication logic")),(0,i.kt)("h2",{id:"decision"},"Decision"),(0,i.kt)("p",null,"The controller module should be simplified to remove the correlation between the authentication logic for an interchain account and the application logic for an interchain account.\nTo minimize disruption to developers working on the original design of the ICS 27 controller module, all changes will be made in a backwards compatible fashion."),(0,i.kt)("h3",{id:"msg-server"},"Msg server"),(0,i.kt)("p",null,"To achieve this, as stated by ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cosmos/ibc-go/issues/2026#issue-1341640594"},"@damiannolan"),", it was proposed to:"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Add a new ",(0,i.kt)("inlineCode",{parentName:"p"},"MsgServer")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"27-interchain-accounts")," which exposes two distinct rpc endpoints:"),(0,i.kt)("ul",{parentName:"blockquote"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"RegisterInterchainAccount")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"SendTx")))),(0,i.kt)("p",null,"This will enable any SDK (authentication) module to register interchain accounts and send transactions on their behalf.\nExamples of existing SDK modules which would benefit from this change include:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"x/auth"),(0,i.kt)("li",{parentName:"ul"},"x/gov"),(0,i.kt)("li",{parentName:"ul"},"x/group")),(0,i.kt)("p",null,"The existing go functions: ",(0,i.kt)("inlineCode",{parentName:"p"},"RegisterInterchainAccount()")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"SendTx()")," will remain to operate as they did in previous release versions."),(0,i.kt)("p",null,"This will be possible for SDK v0.46.x and above."),(0,i.kt)("h3",{id:"allow-nil-underlying-applications"},"Allow ",(0,i.kt)("inlineCode",{parentName:"h3"},"nil")," underlying applications"),(0,i.kt)("p",null,"Authentication modules should interact with the controller module via the message server and should not be associated with application logic.\nFor now, it will be allowed to set a ",(0,i.kt)("inlineCode",{parentName:"p"},"nil")," underlying application.\nA future version may remove the underlying application entirely."),(0,i.kt)("p",null,"See issue ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cosmos/ibc-go/issues/2040"},"#2040")),(0,i.kt)("h3",{id:"channel-capability-claiming"},"Channel capability claiming"),(0,i.kt)("p",null,"The controller module will now claim the channel capability in ",(0,i.kt)("inlineCode",{parentName:"p"},"OnChanOpenInit"),".\nUnderlying applications will be passed a ",(0,i.kt)("inlineCode",{parentName:"p"},"nil")," capability in ",(0,i.kt)("inlineCode",{parentName:"p"},"OnChanOpenInit"),"."),(0,i.kt)("p",null,"Channel capability migrations will be added in two steps:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Upgrade handler migration which modifies the channel capability owner from the underlying app to the controller module"),(0,i.kt)("li",{parentName:"ul"},"ICS 27 module automatic migration which asserts the upgrade handler channel capability migration has been performed successfully")),(0,i.kt)("p",null,"See issue ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cosmos/ibc-go/issues/2033"},"#2033")),(0,i.kt)("h3",{id:"middleware-enabled-channels"},"Middleware enabled channels"),(0,i.kt)("p",null,"In order to maintain backwards compatibility and avoid requiring underlying application developers to account for interchain accounts they did not register, a boolean mapping has been added to track the behaviour of how an account was created."),(0,i.kt)("p",null,"If the account was created via the legacy API, then the underlying application callbacks will be executed."),(0,i.kt)("p",null,"If the account was created with the new API (message server), then the underlying application callbacks will not be executed."),(0,i.kt)("p",null,"See issue ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cosmos/ibc-go/issues/2145"},"#2145")),(0,i.kt)("h3",{id:"future-considerations"},"Future considerations"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/cosmos/ibc-go/pull/1976"},"ADR 008")," proposes the creation of a middleware which enables callers of an IBC packet send to perform application logic in conjunction with the IBC application.\nThe underlying application can be removed at the availability of such a middleware as that will be the preferred method for executing application logic upon a ICS 27 packet send."),(0,i.kt)("h3",{id:"miscellaneous"},"Miscellaneous"),(0,i.kt)("p",null,"In order to avoid import cycles, the genesis types have been moved to their own directory.\nA new protobuf package has been created for the genesis types."),(0,i.kt)("p",null,"See PR ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cosmos/ibc-go/pull/2133"},"#2133")),(0,i.kt)("p",null,"An additional field has been added to the ",(0,i.kt)("inlineCode",{parentName:"p"},"ActiveChannel")," type to store the ",(0,i.kt)("inlineCode",{parentName:"p"},"IsMiddlewareEnabled")," field upon genesis import/export."),(0,i.kt)("p",null,"See issue ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cosmos/ibc-go/issues/2165"},"#2165")),(0,i.kt)("h2",{id:"consequences"},"Consequences"),(0,i.kt)("h3",{id:"positive"},"Positive"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"default authentication modules are provided (x/auth, x/group, x/gov)"),(0,i.kt)("li",{parentName:"ul"},"any SDK authentication module may now be used with ICS 27"),(0,i.kt)("li",{parentName:"ul"},"separation of authentication from application logic in relation to ICS 27"),(0,i.kt)("li",{parentName:"ul"},"minimized disruption to existing development around ICS 27 controller module"),(0,i.kt)("li",{parentName:"ul"},"underlying applications no longer have to handle capabilities"),(0,i.kt)("li",{parentName:"ul"},"removal of the underlying application upon the creation of ADR 008 may be done in a minimally disruptive fashion"),(0,i.kt)("li",{parentName:"ul"},"only underlying applications which registered the interchain account will perform application logic for that account (underlying applications do not need to be aware of accounts they did not register)")),(0,i.kt)("h3",{id:"negative"},"Negative"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"the security model has been reduced to that of the SDK. SDK modules may send packets for any interchain account."),(0,i.kt)("li",{parentName:"ul"},"additional maintenance of the messages added and the middleware enabled flag"),(0,i.kt)("li",{parentName:"ul"},"underlying applications which will become ADR 008 modules are not required to be aware of accounts they did not register"),(0,i.kt)("li",{parentName:"ul"},"calling legacy API vs the new API results in different behaviour for ICS 27 application stacks which have an underlying application")),(0,i.kt)("h3",{id:"neutral"},"Neutral"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"A major release is required")))}d.isMDXComponent=!0}}]);